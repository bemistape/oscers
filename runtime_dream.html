<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trippy Movie Cloud</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
      width: 100%;
      height: 100%;
      font-family: sans-serif;
    }
    #container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .movie {
      position: absolute;
      animation: fadeInOut 12s linear forwards;
      pointer-events: none;
    }
    .movie img {
      max-width: 150px;
      max-height: 200px;
      display: block;
      border: 3px solid #fff;
    }
    .runtime {
      position: absolute;
      bottom: 0;
      width: 100%;
      text-align: center;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      font-size: 0.8em;
      padding: 2px 0;
    }
    .emoji {
      position: absolute;
      animation: floatEmoji 18s linear forwards;
      font-size: 2rem;
      pointer-events: none;
    }
    @keyframes fadeInOut {
      0%   { opacity: 0; transform: translate(0,0) scale(0.5) rotate(0deg); }
      20%  { opacity: 1; transform: translate(0,0) scale(1) rotate(var(--rot)); }
      80%  { opacity: 1; transform: translate(0,0) scale(1) rotate(var(--rot)); }
      100% { opacity: 0; transform: translate(0,0) scale(0.5) rotate(var(--rot)); }
    }
    @keyframes floatEmoji {
      0%   { opacity: 0; transform: translateY(20px) scale(0.5); }
      20%  { opacity: 1; transform: translateY(0) scale(1); }
      80%  { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-20px) scale(0.5); }
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <script>
    // Helper: basic CSV parsing assuming no commas inside fields.
    function parseCSV(data) {
      const lines = data.trim().split('\n');
      const header = lines.shift().split(',');
      return lines.map(line => {
        const cols = line.split(',');
        let obj = {};
        header.forEach((key, idx) => {
          obj[key.trim()] = cols[idx] ? cols[idx].trim() : "";
        });
        return obj;
      });
    }

    // Fetch CSV data and set up animations.
    fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vToIbm5XR9mtqOXHYzpF0jIXhGY9WI9m-QQak2KsZFB6CGVnRVRCPL3V6zFVbT6e_jLyGQM1e5XPjcX/pub?gid=534697964&single=true&output=csv')
      .then(response => response.text())
      .then(data => {
        const movies = parseCSV(data);
        const container = document.getElementById('container');

        function createMoviePoster() {
          if (!movies.length) return;
          const movie = movies[Math.floor(Math.random() * movies.length)];
          const movieElem = document.createElement('div');
          movieElem.className = 'movie';
          // Random rotation stored in a CSS variable
          movieElem.style.setProperty('--rot', Math.floor(Math.random()*360) + 'deg');

          const img = document.createElement('img');
          img.src = movie.poster;
          img.alt = movie.title;
          movieElem.appendChild(img);

          const runtimeDiv = document.createElement('div');
          runtimeDiv.className = 'runtime';
          runtimeDiv.innerText = movie.runtime + ' min';
          movieElem.appendChild(runtimeDiv);

          // Set a random position
          movieElem.style.left = Math.random() * 90 + '%';
          movieElem.style.top = Math.random() * 90 + '%';
          // Random scale effect
          const scale = 0.5 + Math.random() * 0.5;
          movieElem.style.transform = `scale(${scale}) rotate(${Math.random() * 360}deg)`;
          container.appendChild(movieElem);

          // Remove element after its animation duration
          setTimeout(() => {
            if(movieElem.parentNode === container) container.removeChild(movieElem);
          }, 12000);
        }

        function createEmoji() {
          const emojis = ['ðŸ¿', 'ðŸŽ¬'];
          const emoji = emojis[Math.floor(Math.random() * emojis.length)];
          const emojiElem = document.createElement('div');
          emojiElem.className = 'emoji';
          emojiElem.innerText = emoji;
          emojiElem.style.left = Math.random() * 90 + '%';
          emojiElem.style.top = Math.random() * 90 + '%';
          container.appendChild(emojiElem);

          setTimeout(() => {
            if(emojiElem.parentNode === container) container.removeChild(emojiElem);
          }, 18000);
        }

        // Create posters and emojis at intervals.
        setInterval(createMoviePoster, 800);
        setInterval(createEmoji, 1200);
      })
      .catch(err => console.error('Error loading CSV:', err));
  </script>
</body>
</html>
